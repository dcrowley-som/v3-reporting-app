<p-toast></p-toast>
<p-toolbar>
  <ng-template #start>
    <h2 class="flex items-center text-2xl">
      Daily Snapshot
    </h2>
  </ng-template>
  <ng-template #end>
    <div>
      <p-floatlabel variant="on">
        <p-datepicker class="ms-2"  inputId="custom_dates" showIcon iconDisplay="input"
                      [(ngModel)]="rangeDate" [readonlyInput]="true">

        </p-datepicker>
        <label>Select Date</label>
      </p-floatlabel>
    </div>
    <p-button class="ms-2" icon="pi pi-refresh" label="Refresh" (onClick)="refresh()"></p-button>
  </ng-template>
</p-toolbar>
@if (isLoading) {
  <div class="card flex justify-center mt-4">
    <p-progress-spinner [style]="{ width: '50px', height: '50px' }" />
  </div>
}
<div class="mt-4">
  <p-pickList
    [showSourceControls]="false"
    [showTargetControls]="false"
    [source]="providersList()"
    [target]="selectedProviders"
    filterBy="searchable"
    [dragdrop]="true"
    [responsive]="true"
    sourceFilterPlaceholder="Search by name"
    targetFilterPlaceholder="Search by name"
  >
    <ng-template let-item #item>
      {{ item.searchable }}
    </ng-template>
  </p-pickList>
</div>
@if (results()) {
  <p-panel styleClass="mt-4">
    <p-table [value]="results()" showGridlines stripedRows>
      <ng-template #header>
        <tr>
          <th>Provider</th>
          <th>Assigned</th>
          <th>Cases</th>
          <th>Hours</th>
          <th>7-4</th>
          <th>4-7</th>
          <th>7-11</th>
          <th>11-7</th>
          <th>Base U</th>
          <th>Time U</th>
          <th>Total U</th>
        </tr>
      </ng-template>
      <ng-template #body let-row>
        <tr>
          <td>{{row.user}}</td>
          <td>{{row.assignments}}</td>
          <td [pTooltip]="row.episodes"
          >{{row.episodes.length}}</td>
          <td>{{row.count | minutesToHours}}</td>
          <td>{{row.countSevenToFour | minutesToHours}}</td>
          <td>{{row.countFourToSeven | minutesToHours}}</td>
          <td>{{row.countSevenToEleven | minutesToHours}}</td>
          <td>{{row.countElevenToSeven | minutesToHours}}</td>
          <td>{{row.baseUnits}}</td>
          <td>{{row.timeUnits}}</td>
          <td>{{row.totalUnits}}</td>
        </tr>
        <tr >
          <td colspan="11">

            <table class="episode-bars-table">
              <tr>
                <td style="width: 100px"></td>
                <td class="flex flex-1 justify-between">
                  @for (hour of hours; track hour) {
                    <span>{{hour}}</span>
                  }
                </td>
              </tr>
              @for (episode of row.episodes; track episode._id) {
                <tr>
                  <td style="width: 100px">{{episode.episodeId}}</td>
                  <td class="">
                    <app-episode-bar [episode]="episode"></app-episode-bar>
                  </td>
                </tr>
              }
            </table>
          </td>

        </tr>
      </ng-template>
    </p-table>
  </p-panel>
}
